<% provide(:title, "結果") %>

<% a = Array.new(10) {Array.new(2)} %>
<% count = 0 %>

<% for i in 1..10 %>
<% a[i-1][0] = Post.find(session["quiz_id_#{i}"]) %>
<% if a[i-1][1] = a[i-1][0].answer == session["quiz_answer_#{i}"] %>
<% count += 1 %>
<% end %>
<% end %>

<div class="row justify-content-center mt-4">

  <div class="col-mg-6 px-5 text-center">
    <h2 class="text-danger d-inline-block"><%= count %>　問正解！</h2>
    <%= link_to "もう一度", new_quiz_path %>

    <div class="nav flex-column text-left">
      <% for i in 1..10 %>
      <p class="py-2">
        <% if a[i-1][1] %>
        <span class="text-danger"><%= i %>問目: ○</span>
        <% else %>
        <span><%= i %>問目: ×</span>
        <% end %>
        <a href="#" class="nav-link d-inline" id="nav-<%= i %>">
          <%= a[i-1][0].answer %> / <%= session["quiz_answer_#{i}"] %>
        </a>
      </p>
      <% end %>
    </div>
  </div>

  <div class="tab-content mt-4 col-md-8 col-lg-auto">
    <% for i in 1..10 %>
    <div class="tab-pane" id="nav-<%= i %>-content">
      <div class="card" style="width: 25rem;">
        <div class="card-body">
          <div class="row">
            <div class="col-2">
              <%= link_to (icon_for a[i-1][0].user, size: 40), a[i-1][0].user %>
            </div>

            <div class="col-10">
              <strong><%= a[i-1][0].user.name %></strong>
              <% if current_user.following?(a[i-1][0].user) %>
              <small class="fas fa-check-circle ml-1 text-primary"></small>
              <% end %>

              <p class="my-2"><%= a[i-1][0].question %></p>
              <p class="my-2"><%= a[i-1][0].answer %></p>

              <%= render "posts/post_menu", post: a[i-1][0] %>

              <small class="text-secondary"><%= l a[i-1][0].created_at %></small>
            </div>
          </div>
        </div>
      </div>

    </div>
    <% end %>
  </div>
</div>

<script>
  $('.nav a').on('click', function (e) {
    e.preventDefault();
    var nav_id = $(this).attr('id');
    if ($('.active')) {
      $('.active').removeClass('active');
    }
    $(`#${nav_id}-content`).addClass('active');
  });
</script>